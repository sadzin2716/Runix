-- Script PvP Runix Hub - VersÃ£o Corrigida
-- Por favor, execute no executor apropriado (Synapse, KRNL, Fluxus, etc.)

-- Verificar se estamos no Roblox
if not game:IsLoaded() then
    game.Loaded:Wait()
end

-- 1. Biblioteca MaterialLua (requer executor com permissÃ£o de HTTP)
local Material
local success, errorMsg = pcall(function()
    Material = loadstring(game:HttpGet("https://raw.githubusercontent.com/Kinlei/MaterialLua/master/Module.lua"))()
end)

if not success then
    warn("âš ï¸ Falha ao carregar MaterialLua: " .. tostring(errorMsg))
    warn("ðŸ“ Tentando carregar interface bÃ¡sica...")
    
    -- Interface bÃ¡sica alternativa
    local ScreenGui = Instance.new("ScreenGui")
    local TextLabel = Instance.new("TextLabel")
    ScreenGui.Parent = game.CoreGui
    TextLabel.Parent = ScreenGui
    TextLabel.Size = UDim2.new(0, 300, 0, 50)
    TextLabel.Position = UDim2.new(0.5, -150, 0.5, -25)
    TextLabel.Text = "MaterialLua nÃ£o carregou\nUse um executor compatÃ­vel"
    TextLabel.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    TextLabel.TextColor3 = Color3.new(1, 1, 1)
    
    -- Se MaterialLua nÃ£o carregar, pare aqui
    return
end

-- 2. ServiÃ§os essenciais
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- ReferÃªncias importantes
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = Workspace.CurrentCamera

-- Aguardar LocalPlayer carregar completamente
repeat task.wait() until LocalPlayer.Character ~= nil

-- 3. ConfiguraÃ§Ãµes
local Config = {
    -- ESP
    ESP = {
        Enabled = true,
        TeamCheck = true,
        EnemyColor = Color3.fromRGB(255, 50, 50),
        TeamColor = Color3.fromRGB(50, 255, 50),
        FillTransparency = 0.5,
        OutlineTransparency = 0,
        Thickness = 1
    },
    
    -- Aimbot
    Aimbot = {
        Enabled = false,
        AimKey = Enum.UserInputType.MouseButton2, -- BotÃ£o direito
        Smoothness = 0.15,
        FOV = 100,
        VisibleCheck = true,
        TeamCheck = true
    },
    
    -- Hitbox
    Hitbox = {
        Enabled = false,
        Size = Vector3.new(7, 7, 7),
        NormalSize = Vector3.new(2, 2, 1),
        Transparency = 0.6,
        Material = Enum.Material.ForceField
    }
}

-- 4. VariÃ¡veis globais
local ESPCache = {} -- { [Player] = {Highlight = obj, Box = obj} }
local Aiming = false
local FOVCircle

-- 5. FunÃ§Ãµes de utilitÃ¡rio
local function IsEnemy(Player)
    if not Config.ESP.TeamCheck then 
        return true 
    end
    if not LocalPlayer.Team or not Player.Team then 
        return true 
    end
    return Player.Team ~= LocalPlayer.Team
end

local function IsAlive(Character)
    if not Character then return false end
    local Humanoid = Character:FindFirstChildOfClass("Humanoid")
    return Humanoid and Humanoid.Health > 0
end

local function IsVisible(Part)
    if not Config.Aimbot.VisibleCheck then return true end
    
    local Character = LocalPlayer.Character
    if not Character then return false end
    
    local Head = Character:FindFirstChild("Head")
    if not Head then return false end
    
    local Origin = Head.Position
    local Target = Part.Position
    local Direction = (Target - Origin).Unit * (Origin - Target).Magnitude
    
    local RaycastParams = RaycastParams.new()
    RaycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    RaycastParams.FilterDescendantsInstances = {Character, Camera}
    RaycastParams.IgnoreWater = true
    
    local Result = Workspace:Raycast(Origin, Direction, RaycastParams)
    
    if Result then
        local HitParent = Result.Instance:FindFirstAncestorOfClass("Model")
        if HitParent and Players:GetPlayerFromCharacter(HitParent) then
            return true
        end
        return false
    end
    
    return true
end

-- 6. Sistema ESP
local function CreateESP(Player)
    if Player == LocalPlayer then return end
    
    local ESPData = {
        Highlight = nil,
        Box = nil,
        Tracer = nil,
        Character = nil
    }
    
    ESPCache[Player] = ESPData
    
    local function SetupCharacter(Character)
        if not Character then return end
        
        -- Aguardar partes essenciais
        repeat task.wait() until Character:FindFirstChild("HumanoidRootPart")
        
        -- Criar Highlight
        if not ESPData.Highlight then
            ESPData.Highlight = Instance.new("Highlight")
            ESPData.Highlight.Name = "ESP_Highlight_" .. Player.Name
            ESPData.Highlight.FillTransparency = Config.ESP.FillTransparency
            ESPData.Highlight.OutlineTransparency = Config.ESP.OutlineTransparency
            ESPData.Highlight.OutlineThickness = Config.ESP.Thickness
            ESPData.Highlight.Adornee = Character
            ESPData.Highlight.Parent = Character
        end
        
        -- Criar Box Outline
        if not ESPData.Box then
            ESPData.Box = Instance.new("BoxHandleAdornment")
            ESPData.Box.Name = "ESP_Box_" .. Player.Name
            ESPData.Box.Adornee = Character:WaitForChild("HumanoidRootPart")
            ESPData.Box.AlwaysOnTop = true
            ESPData.Box.ZIndex = 5
            ESPData.Box.Size = Character.HumanoidRootPart.Size * 1.2
            ESPData.Box.Transparency = 0.7
            ESPData.Box.Parent = Character.HumanoidRootPart
        end
        
        ESPData.Character = Character
        
        -- Atualizar cores
        if ESPData.Highlight and ESPData.Box then
            local IsEnemyPlayer = IsEnemy(Player)
            local Color = IsEnemyPlayer and Config.ESP.EnemyColor or Config.ESP.TeamColor
            
            ESPData.Highlight.FillColor = Color
            ESPData.Highlight.OutlineColor = Color
            ESPData.Highlight.Enabled = Config.ESP.Enabled and IsAlive(Character)
            
            ESPData.Box.Color3 = Color
            ESPData.Box.Visible = Config.ESP.Enabled and IsAlive(Character)
        end
    end
    
    -- Conectar eventos
    if Player.Character then
        SetupCharacter(Player.Character)
    end
    
    Player.CharacterAdded:Connect(function(Character)
        SetupCharacter(Character)
    end)
    
    Player.CharacterRemoving:Connect(function()
        if ESPData.Highlight then
            ESPData.Highlight:Destroy()
            ESPData.Highlight = nil
        end
        if ESPData.Box then
            ESPData.Box:Destroy()
            ESPData.Box = nil
        end
        ESPData.Character = nil
    end)
end

local function UpdateAllESP()
    for Player, ESPData in pairs(ESPCache) do
        if ESPData.Character and ESPData.Highlight and ESPData.Box then
            local IsEnemyPlayer = IsEnemy(Player)
            local Color = IsEnemyPlayer and Config.ESP.EnemyColor or Config.ESP.TeamColor
            local IsAliveChar = IsAlive(ESPData.Character)
            
            ESPData.Highlight.FillColor = Color
            ESPData.Highlight.OutlineColor = Color
            ESPData.Highlight.Enabled = Config.ESP.Enabled and IsAliveChar
            
            ESPData.Box.Color3 = Color
            ESPData.Box.Visible = Config.ESP.Enabled and IsAliveChar
            
            -- Atualizar tamanho do box
            if ESPData.Character:FindFirstChild("HumanoidRootPart") then
                ESPData.Box.Size = ESPData.Character.HumanoidRootPart.Size * 1.2
                ESPData.Box.Adornee = ESPData.Character.HumanoidRootPart
            end
        end
    end
end

-- 7. Sistema Hitbox
local function UpdateHitboxes()
    for Player, ESPData in pairs(ESPCache) do
        if ESPData.Character and ESPData.Character:FindFirstChild("HumanoidRootPart") then
            local HRP = ESPData.Character.HumanoidRootPart
            
            if Config.Hitbox.Enabled and IsEnemy(Player) then
                HRP.Size = Config.Hitbox.Size
                HRP.Transparency = Config.Hitbox.Transparency
                HRP.Material = Config.Hitbox.Material
                HRP.CanCollide = false
            else
                HRP.Size = Config.Hitbox.NormalSize
                HRP.Transparency = 1
                HRP.Material = Enum.Material.Plastic
            end
        end
    end
end

-- 8. Sistema Aimbot
local function GetClosestTarget()
    local ClosestPlayer = nil
    local ShortestDistance = Config.Aimbot.FOV
    local MousePosition = Vector2.new(Mouse.X, Mouse.Y)
    
    for _, Player in pairs(Players:GetPlayers()) do
        if Player == LocalPlayer then continue end
        if not Player.Character then continue end
        
        local Character = Player.Character
        local Humanoid = Character:FindFirstChildOfClass("Humanoid")
        if not Humanoid or Humanoid.Health <= 0 then continue end
        
        if Config.Aimbot.TeamCheck and not IsEnemy(Player) then continue end
        
        local Head = Character:FindFirstChild("Head")
        if not Head then continue end
        
        local ScreenPosition, OnScreen = Camera:WorldToViewportPoint(Head.Position)
        if not OnScreen then continue end
        
        if Config.Aimbot.VisibleCheck and not IsVisible(Head) then continue end
        
        local ScreenPoint = Vector2.new(ScreenPosition.X, ScreenPosition.Y)
        local Distance = (MousePosition - ScreenPoint).Magnitude
        
        if Distance < ShortestDistance then
            ShortestDistance = Distance
            ClosestPlayer = Player
        end
    end
    
    return ClosestPlayer
end

-- 9. FOV Circle Drawing
if Drawing then
    FOVCircle = Drawing.new("Circle")
    FOVCircle.Visible = false
    FOVCircle.Radius = Config.Aimbot.FOV
    FOVCircle.Thickness = 1
    FOVCircle.Color = Color3.fromRGB(255, 255, 100)
    FOVCircle.Filled = false
    FOVCircle.Transparency = 0.7
else
    warn("âš ï¸ Drawing nÃ£o estÃ¡ disponÃ­vel, FOV Circle desativado")
end

-- 10. Loop principal
spawn(function()
    -- Inicializar ESP para jogadores existentes
    for _, Player in pairs(Players:GetPlayers()) do
        CreateESP(Player)
    end
    
    -- Conectar eventos
    Players.PlayerAdded:Connect(function(Player)
        CreateESP(Player)
    end)
    
    Players.PlayerRemoving:Connect(function(Player)
        if ESPCache[Player] then
            if ESPCache[Player].Highlight then
                ESPCache[Player].Highlight:Destroy()
            end
            if ESPCache[Player].Box then
                ESPCache[Player].Box:Destroy()
            end
            ESPCache[Player] = nil
        end
    end)
    
    -- Loop de atualizaÃ§Ã£o
    while task.wait(0.1) do
        if Config.ESP.Enabled then
            UpdateAllESP()
        end
        
        if Config.Hitbox.Enabled then
            UpdateHitboxes()
        end
        
        -- Atualizar FOV Circle
        if FOVCircle then
            FOVCircle.Position = Vector2.new(Mouse.X, Mouse.Y + 36)
            FOVCircle.Radius = Config.Aimbot.FOV
            FOVCircle.Visible = Config.Aimbot.Enabled and Aiming
        end
    end
end)

-- 11. Input para Aimbot
UserInputService.InputBegan:Connect(function(Input, GameProcessed)
    if GameProcessed then return end
    
    if Input.UserInputType == Config.Aimbot.AimKey and Config.Aimbot.Enabled then
        Aiming = true
    end
end)

UserInputService.InputEnded:Connect(function(Input)
    if Input.UserInputType == Config.Aimbot.AimKey then
        Aiming = false
    end
end)

-- 12. Loop do Aimbot
RunService.RenderStepped:Connect(function()
    if not Config.Aimbot.Enabled or not Aiming then return end
    
    local Target = GetClosestTarget()
    if not Target or not Target.Character then return end
    
    local Head = Target.Character:FindFirstChild("Head")
    if not Head then return end
    
    local CurrentCFrame = Camera.CFrame
    local TargetPosition = Head.Position + Vector3.new(0, 1.5, 0) -- Mira um pouco acima da cabeÃ§a
    
    local SmoothedCFrame = CurrentCFrame:Lerp(
        CFrame.new(CurrentCFrame.Position, TargetPosition),
        Config.Aimbot.Smoothness
    )
    
    Camera.CFrame = SmoothedCFrame
end)

-- 13. Interface com MaterialLua
local Themes = {"Dark", "Light", "Aqua", "Jester"}
local UI

local function CreateUI(Theme)
    if UI then
        UI:Destroy()
        task.wait(0.1)
    end
    
    UI = Material.Load({
        Title = "Runix Hub - PvP",
        Style = 3,
        SizeX = 450,
        SizeY = 500,
        Theme = Theme or "Dark"
    })
    
    -- Aba Principal
    local MainTab = UI.New({Title = "Main"})
    
    MainTab.Toggle({
        Text = "Enable ESP",
        Callback = function(State)
            Config.ESP.Enabled = State
            UpdateAllESP()
        end,
        Enabled = Config.ESP.Enabled
    })
    
    MainTab.Toggle({
        Text = "Enable Aimbot",
        Callback = function(State)
            Config.Aimbot.Enabled = State
            if not State then
                Aiming = false
            end
        end,
        Enabled = Config.Aimbot.Enabled
    })
    
    MainTab.Toggle({
        Text = "Enable Hitbox",
        Callback = function(State)
            Config.Hitbox.Enabled = State
            UpdateHitboxes()
        end,
        Enabled = Config.Hitbox.Enabled
    })
    
    MainTab.Button({
        Text = "Update All Players",
        Callback = function()
            UpdateAllESP()
            UpdateHitboxes()
            Material.Snackbar("All players updated!")
        end
    })
    
    -- Aba ESP
    local ESPTab = UI.New({Title = "ESP Settings"})
    
    ESPTab.ColorPicker({
        Text = "Enemy Color",
        Default = Config.ESP.EnemyColor,
        Callback = function(Color)
            Config.ESP.EnemyColor = Color
            UpdateAllESP()
        end
    })
    
    ESPTab.ColorPicker({
        Text = "Team Color",
        Default = Config.ESP.TeamColor,
        Callback = function(Color)
            Config.ESP.TeamColor = Color
            UpdateAllESP()
        end
    })
    
    ESPTab.Toggle({
        Text = "Team Check",
        Callback = function(State)
            Config.ESP.TeamCheck = State
            UpdateAllESP()
        end,
        Enabled = Config.ESP.TeamCheck
    })
    
    ESPTab.Slider({
        Text = "ESP Transparency",
        Min = 0,
        Max = 1,
        Def = Config.ESP.FillTransparency,
        Callback = function(Value)
            Config.ESP.FillTransparency = Value
            for _, ESPData in pairs(ESPCache) do
                if ESPData.Highlight then
                    ESPData.Highlight.FillTransparency = Value
                end
            end
        end,
        Decimals = 1
    })
    
    -- Aba Aimbot
    local AimbotTab = UI.New({Title = "Aimbot Settings"})
    
    AimbotTab.Slider({
        Text = "Aimbot FOV",
        Min = 20,
        Max = 500,
        Def = Config.Aimbot.FOV,
        Callback = function(Value)
            Config.Aimbot.FOV = Value
            if FOVCircle then
                FOVCircle.Radius = Value
            end
        end
    })
    
    AimbotTab.Slider({
        Text = "Smoothness",
        Min = 0.05,
        Max = 1,
        Def = Config.Aimbot.Smoothness,
        Callback = function(Value)
            Config.Aimbot.Smoothness = Value
        end,
        Decimals = 2
    })
    
    AimbotTab.Toggle({
        Text = "Visible Check",
        Callback = function(State)
            Config.Aimbot.VisibleCheck = State
        end,
        Enabled = Config.Aimbot.VisibleCheck
    })
    
    AimbotTab.Toggle({
        Text = "Team Check",
        Callback = function(State)
            Config.Aimbot.TeamCheck = State
        end,
        Enabled = Config.Aimbot.TeamCheck
    })
    
    -- Aba Hitbox
    local HitboxTab = UI.New({Title = "Hitbox Settings"})
    
    HitboxTab.Slider({
        Text = "Hitbox Size",
        Min = 2,
        Max = 20,
        Def = Config.Hitbox.Size.X,
        Callback = function(Value)
            Config.Hitbox.Size = Vector3.new(Value, Value, Value)
            UpdateHitboxes()
        end
    })
    
    HitboxTab.Slider({
        Text = "Hitbox Transparency",
        Min = 0,
        Max = 1,
        Def = Config.Hitbox.Transparency,
        Callback = function(Value)
            Config.Hitbox.Transparency = Value
            UpdateHitboxes()
        end,
        Decimals = 1
    })
    
    -- Aba ConfiguraÃ§Ãµes
    local SettingsTab = UI.New({Title = "Settings"})
    
    SettingsTab.Dropdown({
        Text = "UI Theme",
        Options = Themes,
        Callback = function(Selected)
            CreateUI(Selected)
            Material.Snackbar("Theme changed to: " .. Selected)
        end
    })
    
    SettingsTab.Button({
        Text = "Destroy GUI",
        Callback = function()
            if UI then
                UI:Destroy()
                UI = nil
                Material.Snackbar("GUI destroyed! Reload script to show again.")
            end
        end
    })
    
    SettingsTab.Button({
        Text = "Reload Script",
        Callback = function()
            Material.Snackbar("Please re-execute the script manually.")
        end
    })
    
    SettingsTab.Label({
        Text = "Runix Hub v1.0",
        Center = true
    })
    
    -- Inicializar UI
    UI.Init()
end

-- 14. InicializaÃ§Ã£o
spawn(function()
    task.wait(1) -- Esperar um pouco antes de criar a UI
    local Success, Err = pcall(function()
        CreateUI("Dark")
    end)
    
    if not Success then
        warn("âš ï¸ Erro ao criar interface: " .. tostring(Err))
        
        -- Criar interface bÃ¡sica alternativa
        local BasicGUI = Instance.new("ScreenGui")
        local Frame = Instance.new("Frame")
        local TextLabel = Instance.new("TextLabel")
        
        BasicGUI.Name = "RunixHubGUI"
        BasicGUI.Parent = game.CoreGui
        
        Frame.Size = UDim2.new(0, 200, 0, 60)
        Frame.Position = UDim2.new(0.5, -100, 0, 10)
        Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        Frame.BorderSizePixel = 0
        Frame.Parent = BasicGUI
        
        TextLabel.Size = UDim2.new(1, 0, 1, 0)
        TextLabel.BackgroundTransparency = 1
        TextLabel.Text = "Runix Hub PvP\nLoaded Successfully"
        TextLabel.TextColor3 = Color3.new(1, 1, 1)
        TextLabel.TextScaled = true
        TextLabel.Parent = Frame
    else
        print("âœ… Runix Hub PvP carregado com sucesso!")
        print("ðŸ“ ESP: " .. tostring(Config.ESP.Enabled))
        print("ðŸŽ¯ Aimbot: " .. tostring(Config.Aimbot.Enabled))
        print("ðŸ”² Hitbox: " .. tostring(Config.Hitbox.Enabled))
    end
end)

-- 15. Limpeza automÃ¡tica
game:GetService("UserInputService").WindowFocusReleased:Connect(function()
    -- Resetar estado quando perder foco
    Aiming = false
end)

-- NotificaÃ§Ã£o de inicializaÃ§Ã£o
warn("[Runix Hub] Script PvP carregado!")
warn("[Controls] Right Mouse Button: Aimbot")
warn("[Status] ESP: ON | Aimbot: READY | Hitbox: CONFIGURABLE")
